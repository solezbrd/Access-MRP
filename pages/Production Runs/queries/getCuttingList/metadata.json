{
  "gitSyncId": "699387b8cf3d5e4f99911848_f33a3a49-30ef-43a7-adfe-733ec1cc71cf",
  "id": "Production Runs_getCuttingList",
  "pluginId": "postgres-plugin",
  "pluginType": "DB",
  "unpublishedAction": {
    "actionConfiguration": {
      "body": "SELECT \n    b.timber,\n    b.profile,\n    b.length,\n    b.qty as bom_qty,\n    b.qty * {{tblProductionRuns.selectedRow.qty}} as total_qty,\n    CASE\n        WHEN sp_exact.id IS NOT NULL THEN 'Ready'\n        WHEN sp_longer.length IS NOT NULL THEN 'Needs Cutting'\n        WHEN sp_raw.id IS NOT NULL THEN 'Needs Cutting'\n        ELSE 'Needs Ordering'\n    END as status,\n    CASE\n        WHEN sp_exact.id IS NOT NULL THEN NULL\n        WHEN sp_longer.length IS NOT NULL THEN sp_longer.length\n        ELSE NULL\n    END as cut_from\nFROM bom b\nLEFT JOIN stock_profiles sp_exact ON b.timber = sp_exact.timber \n    AND b.profile = sp_exact.profile \n    AND b.length = sp_exact.length\nLEFT JOIN LATERAL (\n    SELECT length, id FROM stock_profiles \n    WHERE timber = b.timber AND profile = b.profile \n    AND length > b.length\n    ORDER BY length ASC\n    LIMIT 1\n) sp_longer ON sp_exact.id IS NULL\nLEFT JOIN stock_profiles sp_raw ON b.timber = sp_raw.timber \n    AND b.profile = sp_raw.profile \n    AND sp_raw.length IS NULL\n    AND sp_exact.id IS NULL \n    AND sp_longer.id IS NULL\nWHERE b.product_no = {{tblProductionRuns.selectedRow.product_no}};",
      "encodeParamsToggle": true,
      "paginationType": "NONE",
      "pluginSpecifiedTemplates": [
        {
          "value": true
        }
      ],
      "timeoutInMillisecond": 10000
    },
    "confirmBeforeExecute": false,
    "datasource": {
      "id": "Access MRP",
      "isAutoGenerated": false,
      "name": "Access MRP",
      "pluginId": "postgres-plugin"
    },
    "dynamicBindingPathList": [
      {
        "key": "body"
      }
    ],
    "name": "getCuttingList",
    "pageId": "Production Runs",
    "runBehaviour": "AUTOMATIC",
    "userSetOnLoad": false
  }
}