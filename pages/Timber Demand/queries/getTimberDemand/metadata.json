{
  "gitSyncId": "699387b8cf3d5e4f99911848_6dbcf169-00dc-4a45-81fc-5678d5577153",
  "id": "Timber Demand_getTimberDemand",
  "pluginId": "postgres-plugin",
  "pluginType": "DB",
  "unpublishedAction": {
    "actionConfiguration": {
      "body": "SELECT \n    b.timber,\n    b.profile,\n    COALESCE(sp_exact.length, sp_longer.length) as order_length,\n    ROUND(\n        SUM(\n            b.qty * pr.qty * \n            (SPLIT_PART(b.profile, 'x', 1)::numeric / 1000) * \n            (SPLIT_PART(b.profile, 'x', 2)::numeric / 1000) * \n            (COALESCE(sp_exact.length, sp_longer.length, b.length)::numeric / 1000)\n        )\n    , 4) as total_m3\nFROM production_runs pr\nJOIN bom b ON pr.product_no = b.product_no\nLEFT JOIN stock_profiles sp_exact ON b.timber = sp_exact.timber \n    AND b.profile = sp_exact.profile \n    AND b.length = sp_exact.length\nLEFT JOIN LATERAL (\n    SELECT length, id FROM stock_profiles \n    WHERE timber = b.timber AND profile = b.profile \n    AND length > b.length\n    ORDER BY length ASC\n    LIMIT 1\n) sp_longer ON sp_exact.id IS NULL\nWHERE pr.status = 'Pending'\n    AND ({{selTimber.selectedOptionValue}} = 'All' OR b.timber = {{selTimber.selectedOptionValue}})\nGROUP BY b.timber, b.profile, COALESCE(sp_exact.length, sp_longer.length)\nORDER BY b.timber, b.profile, order_length;",
      "encodeParamsToggle": true,
      "paginationType": "NONE",
      "pluginSpecifiedTemplates": [
        {
          "value": true
        }
      ],
      "timeoutInMillisecond": 10000
    },
    "confirmBeforeExecute": false,
    "datasource": {
      "id": "Access MRP",
      "isAutoGenerated": false,
      "name": "Access MRP",
      "pluginId": "postgres-plugin"
    },
    "dynamicBindingPathList": [
      {
        "key": "body"
      }
    ],
    "name": "getTimberDemand",
    "pageId": "Timber Demand",
    "runBehaviour": "AUTOMATIC",
    "userSetOnLoad": false
  }
}