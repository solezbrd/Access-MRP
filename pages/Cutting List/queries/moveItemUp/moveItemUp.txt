WITH target AS (
    SELECT id, sort_order FROM cutting_list WHERE id = {{tblCuttingList.triggeredRow.id}}
),
prev AS (
    SELECT id, sort_order FROM cutting_list
    WHERE sort_order < (SELECT sort_order FROM target)
    ORDER BY sort_order DESC LIMIT 1
),
swap AS (
    SELECT t.id AS tid, t.sort_order AS t_sort, p.id AS pid, p.sort_order AS p_sort
    FROM target t, prev p
)
UPDATE cutting_list
SET sort_order = CASE
    WHEN cutting_list.id = (SELECT tid FROM swap) THEN (SELECT p_sort FROM swap)
    WHEN cutting_list.id = (SELECT pid FROM swap) THEN (SELECT t_sort FROM swap)
END
WHERE cutting_list.id IN ((SELECT tid FROM swap), (SELECT pid FROM swap));
